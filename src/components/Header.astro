<header
  class={`
    flex justify-center items-center
    mx-auto
    py-5
    sticky top-0
    lg:w-[740px]
    z-10
  `}
>
  <nav
    class={`
      rounded-full
      px-3 py-1
      flex flex-row items-center
      backdrop-blur-2xl
      gap-x-10 opacity-80
      `}
  >
    <a
      class="hover:scale-110 hover:bg-white/20 rounded-full transition px-2"
      href="/"
      >Inicio
    </a>
    <a
      class="hover:scale-110 hover:bg-white/20 rounded-full transition px-2"
      href="/#experiencia"
      >Experiencia
    </a>
    <a
      class="hover:scale-110 hover:bg-white/20 rounded-full transition px-2"
      href="/#proyectos"
      >Proyectos
    </a>
    <a
      class="hover:scale-110 hover:bg-white/20 rounded-full transition px-2"
      href="/notas"
      >Notas
    </a>
    <button
      id="theme-toggle"
      class="ml-4 p-2 rounded-full hover:bg-white/20 transition"
      title="Cambiar tema"
      type="button"
    >
      <svg
        id="theme-toggle-light-icon"
        class="w-5 h-5 hidden"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="1.8"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <circle cx="12" cy="12" r="4" />
        <path d="M12 3v1.8" />
        <path d="M12 19.2V21" />
        <path d="M4.22 4.22 5.5 5.5" />
        <path d="M18.5 18.5 19.78 19.78" />
        <path d="M3 12h1.8" />
        <path d="M19.2 12H21" />
        <path d="M4.22 19.78 5.5 18.5" />
        <path d="M18.5 5.5 19.78 4.22" />
      </svg>
      <svg id="theme-toggle-dark-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z" />
      </svg>
    </button>
  </nav>
</header>

<script>
  const $navAElements: Element[] = [...document.querySelectorAll('header nav a')].filter(a => 
    a.getAttribute('href')?.startsWith('/#')
  )

  window.addEventListener('scroll', () => {
    $navAElements.forEach(a => {
      const selectionForSection = a.getAttribute('href')?.substring(1)
      const sectionElement: HTMLDivElement | null = document.querySelector(selectionForSection || '')

      if(!sectionElement) return
      const selectionTop = sectionElement.offsetTop - 150
      if(window.scrollY <= selectionTop) return
      $navAElements.forEach(aToRemove => aToRemove.classList.remove('bg-white/15'))
      a.classList.add('bg-white/15')
    })
  })
</script>

<script>
  // Theme toggle logic
  const themeToggleBtn = document.getElementById('theme-toggle');
  const lightIcon = document.getElementById('theme-toggle-light-icon');
  const darkIcon = document.getElementById('theme-toggle-dark-icon');

  // Inicializa el icono correcto
  function updateThemeIcon() {
    if (!lightIcon || !darkIcon) return; // Null check

    if (
      localStorage.getItem('theme') === 'dark' ||
      (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      document.documentElement.classList.add('dark');
      darkIcon.classList.remove('hidden');
      lightIcon.classList.add('hidden');
    } else {
      document.documentElement.classList.remove('dark');
      lightIcon.classList.remove('hidden');
      darkIcon.classList.add('hidden');
    }
  }

  updateThemeIcon();

  if (themeToggleBtn) { // Null check
    themeToggleBtn.addEventListener('click', function () {
      if (document.documentElement.classList.contains('dark')) {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      } else {
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      }
      updateThemeIcon();
    });
  }
</script>
